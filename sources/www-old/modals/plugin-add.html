<!--New plugin Modal -->
<div class="modal fade" id="new-plugin-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" data-i18n="modals.add-plugin.title"></h4>
            </div>
            <div class="modal-body">
               <form>
                  <div class="form-group">
                     <label for="pluginTypeList" data-i18n="modals.add-plugin.pluginType"></label>
                     <select id="pluginTypeList" class="form-control">
                     </select>
                  </div>
               </form>
            </div>
           <div class="modal-footer">
             <!-- Show button when something behind is available
                  <button id="btn-get-more-plugin" type="button" class="btn btn-primary pull-left" data-i18n="modals.add-plugin.getMore"></button>
              -->
              <button type="button" class="btn btn-default" data-dismiss="modal" data-i18n="common.cancel"></button>
              <button id="btn-confirm-add-plugin" type="button" class="btn btn-primary" data-i18n="common.ok"></button>
           </div>
        </div>
    </div>
</div>

<script>
    /**
     * Ask for plugin types to the REST server
     */
   Yadoms.askPluginTypes = function(callback) {

      YadomsInformationManager.getList()
      .done(function (data) {      
         $("select#pluginTypeList").empty();

         // Enter all Plugins into an array
         var tabPlugins = [];
	  
         Object.keys(PluginManager.pluginTypes).forEach(function(key) {
            if( (!data.developerMode && !key.startsWith("dev-")) || data.developerMode) {
               var value = PluginManager.pluginTypes[key];
               tabPlugins.push ( {type: value.type, friendlyName: $.t("plugins/" + value.type + ":name" ) });
            }
         });
	  
         // sort each Plugins Name in the language selected
         tabPlugins = sortListItemsWithFriendlyName ( tabPlugins );
	  
         //foreach element of the array
         $.each(tabPlugins, function(index, value) {
            $("select#pluginTypeList").append("<option value=\"" + value.type + "\">" + value.friendlyName + "</option>");
         });

         //event click on add plugin button
         $("button#btn-confirm-add-plugin").unbind("click").bind("click", function() {
            //we close the new plugin modal
            $("div#new-plugin-modal").modal("hide");
            var pluginType = $("select#pluginTypeList").val();
            callback(PluginManager.pluginTypes[pluginType]);
         });

         //i18n
         $("div#new-plugin-modal .modal-body").i18n();

         //we display the modal
         $('div#new-plugin-modal').modal({ backdrop: 'static' });
      });
   };

</script>